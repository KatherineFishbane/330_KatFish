(()=>{"use strict";var e,t,r,o,n,a,c,l={d:(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};l.d({},{T:()=>I});var i=Object.freeze({gain:.5,numSamples:256}),u=(new Uint8Array(i.numSamples/2),function(e){t.src=e});function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}var f,d,h,v,g,y,m=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(r,",").concat(o,")")},b=function(){var e=function(){return 185*Math.random()+35};return"rgba(".concat(e(),",").concat(e(),",").concat(e(),",1)")},p=function(e,t,r){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onload=function(e){if(200===o.status)try{var n=e.target.responseText,a=(n=JSON.parse(n))[t]||[];r(a)}catch(e){console.error("Error parsing JSON:",e)}else console.error("Failed to load data")},o.onerror=function(){return console.error("XHR request error")},o.send()};function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,q(o.key),o)}}function q(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}var k,C,B=[],A=function(){return e=function e(t,r,o,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("".concat(this.constructor.type," created")),this.x=t,this.y=r,this.radius=o,this.color=n},t=[{key:"update",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]/20;t/=e.length,this.radius=t}},{key:"draw",value:function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()}}],t&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();k=A,(C=q(C="type"))in k?Object.defineProperty(k,C,{value:"arc",enumerable:!0,configurable:!0,writable:!0}):k[C]="arc";var M=function(e,t){f=e.getContext("2d"),d=e.width,h=e.height,v=function(e,t,r,o,n){var a,c=e.createLinearGradient(0,0,0,n),l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw a}}}}([{percent:0,color:"midnightblue"},{percent:.3,color:"lightseagreen"},{percent:.6,color:"orangered"},{percent:.8,color:"orange"},{percent:1,color:"gold"}]);try{for(l.s();!(a=l.n()).done;){var i=a.value;c.addColorStop(i.percent,i.color)}}catch(e){l.e(e)}finally{l.f()}return c}(f,0,0,0,h),g=t,y=new Uint8Array(g.fftSize/2);for(var r=0;r<30;r++){var o=Math.random()*d,n=Math.random()*h,a=b();B.push(new A(o,n,1,a))}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g.getByteFrequencyData(y),f.save(),f.fillStyle="black",f.globalAlpha=.1,f.fillRect(0,0,d,h),f.restore(),e.showGradient&&(f.save(),f.fillStyle=v,f.globalAlpha=.3,f.fillRect(0,0,d,h),f.restore()),e.showBars){var t=(d-4*y.length-10)/y.length;f.save(),f.fillStyle="rgba(255,255,255,0.5)",f.strokeStyle="rgba(0,0,0,0.5)";for(var r=0;r<y.length;r++)f.fillRect(5+r*(t+4),356-y[r],t,200),f.strokeRect(5+r*(t+4),356-y[r],t,200);f.restore()}if(e.showCircles){var o=h/4;f.save(),f.globalAlpha=.5;for(var n=0;n<y.length;n++){f.save();var a=y[n]/256,c=a*o;f.beginPath(),f.fillStyle=m(255,111,111,.34-a/3),f.arc(d/2,h/2,c,0,2*Math.PI,!1),f.fill(),f.closePath(),f.restore(),f.save(),f.beginPath(),f.fillStyle=m(0,0,255,.1-a/10),f.arc(d/2,h/2,1.5*c,0,2*Math.PI,!1),f.fill(),f.closePath(),f.restore(),f.save(),f.beginPath(),f.fillStyle=m(200,200,0,.5-a/5),f.arc(d/2,h/2,.5*c,0,2*Math.PI,!1),f.fill(),f.closePath(),f.restore()}f.restore()}var l=f.getImageData(0,0,d,h),i=l.data,u=i.length,s=l.width;if(e.showEmboss)for(var p=0;p<u;p++)p%4!=3&&(i[p]=127+2*i[p]-i[p+4]-i[p+4*s]);for(var w=0;w<u;w+=4)if(e.showNoise&&Math.random()<.05&&(i[w]=i[w+1]=i[w+2]=0,i[w]=200,i[w+1]=150,i[w+2]=50),e.showInvert){var S=i[w],q=i[w+1],k=i[w+2];i[w]=255-S,i[w+1]=255-q,i[w+2]=255-k}if(f.putImageData(l,0,0),e.showWaveform){g.getByteTimeDomainData(y),f.save(),f.lineWidth=10,f.strokeStyle="rgba(209, 32, 32, 0.5)",f.beginPath();for(var C=1*d/y.length,M=0,E=0;E<y.length;E++){var T=y[E]/128*h/2;0===E?f.moveTo(M,T):f.lineTo(M,T),M+=C}f.stroke(),f.closePath(),f.restore()}for(var j=0,I=B;j<I.length;j++){var F=I[j];F.update(y),F.draw(f)}for(var R=0,O=0;O<y.length;O++)R+=y[O];R/=y.length,P.prevEnergy||(P.prevEnergy=R);var x=R-P.prevEnergy;if(P.prevEnergy=R,x>15&&B.length<60)for(var z=0;z<3;z++)B.push(new A(Math.random()*d,Math.random()*h,1+3*Math.random(),b()));for(var N=0,G=B;N<G.length;N++){var D=G[N];R<50?Math.random()<.05?D.color=b():D.color="AliceBlue":R<130?Math.random()<.4?D.color=b():D.color="AliceBlue":D.color=b()}};function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}window.onload=function(){console.log("window.onload called"),I()};var T={},j=Object.freeze({sound1:"media/New Adventure Theme.mp3"}),I=function(){var l,s;console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat(b())),l=j.sound1,s=window.AudioContext||window.webkitAudioContext,e=new s,t=new Audio,u(l),r=e.createMediaElementSource(t),(o=e.createAnalyser()).fftSize=i.numSamples,(n=e.createGain()).gain.value=i.gain,(c=e.createBiquadFilter()).type="lowshelf",c.frequency.value=500,c.gain.value=0,(a=e.createBiquadFilter()).type="highshelf",a.frequency.value=2e3,a.gain.value=0,r.connect(c),c.connect(a),a.connect(o),o.connect(n),n.connect(e.destination);var f=document.querySelector("canvas");F(f),M(f,o),x(),O(),z(),R()},F=function(r){var o=document.querySelector("#fs-button"),l=document.querySelector("#play-button");o.onclick=function(e){var t;console.log("goFullscreen() called"),(t=r).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},l.onclick=function(r){console.log("audio.audioCtx state = ".concat(e.state)),"suspended"==e.state&&e.resume(),console.log("audioCtx state = ".concat(e.state)),"no"==r.target.dataset.playing?(t.play(),r.target.dataset.playing="yes"):(t.pause(),r.target.dataset.playing="no")};var i=document.querySelector("#volume-slider"),s=document.querySelector("#volume-label");i.oninput=function(e){var t;t=e.target.value,t=Number(t),n.gain.value=t,s.innerHTML=Math.round(e.target.value/2*100)},i.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){u(e.target.value),"yes"==l.dataset.playing&&l.dispatchEvent(new MouseEvent("click"))};var f=document.querySelector("#gradient-CB"),d=document.querySelector("#bars-CB"),h=document.querySelector("#circles-CB"),v=document.querySelector("#noise-CB"),g=document.querySelector("#invert-CB"),y=document.querySelector("#emboss-CB"),m=document.querySelector("#waveform-CB"),b=document.querySelector("#bass-CB"),p=document.querySelector("#treble-CB");m.onchange=function(e){T.showWaveform=e.target.checked},b.onchange=function(e){var t;T.showBass=e.target.checked,t=e.target.checked,c&&(c.gain.value=t?15:0,console.log("Bass boost:",c.gain.value))},p.onchange=function(e){var t;T.showTreble=e.target.checked,t=e.target.checked,a&&(a.gain.value=t?15:0,console.log("Treble boost:",a.gain.value))},f.onchange=function(e){T.showGradient=e.target.checked},d.onchange=function(e){T.showBars=e.target.checked},h.onchange=function(e){T.showCircles=e.target.checked},v.onchange=function(e){T.showNoise=e.target.checked},g.onchange=function(e){T.showInvert=e.target.checked},y.onchange=function(e){T.showEmboss=e.target.checked}},R=function(){setTimeout(R,1e3/60),P(T)},O=function(){var e=document.querySelector("#track-select");p("data/av-data.json","songs",function(t){console.log("fetchSongs callback called"),console.log(t);var r,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return E(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw a}}}}(t);try{for(o.s();!(r=o.n()).done;){var n=r.value,a=document.createElement("option");a.value=n.url,a.innerHTML=n.title,e.appendChild(a)}}catch(e){o.e(e)}finally{o.f()}})},x=function(){p("data/av-data.json","defaults",function(e){console.log("fetchDefaultState callback called"),console.log(e);var t=e[0];T.showGradient=t.gradient,T.showBars=t.bars,T.showCircles=t.circles,T.showNoise=t.noise,T.showInvert=t.invert,T.showEmboss=t.emboss,T.showWaveform=t.waveform,T.showBass=t.bass,T.showTreble=t.treble,console.log(T),document.querySelector("#gradient-CB").checked=T.showGradient,document.querySelector("#bars-CB").checked=T.showBars,document.querySelector("#circles-CB").checked=T.showCircles,document.querySelector("#noise-CB").checked=T.showNoise,document.querySelector("#invert-CB").checked=T.showInvert,document.querySelector("#emboss-CB").checked=T.showEmboss,document.querySelector("#waveform-CB").checked=T.showWaveform,document.querySelector("#bass-CB").checked=T.showBass,document.querySelector("#treble-CB").checked=T.showTreble,P(T)})},z=function(){p("data/av-data.json","title",function(e){document.title=e;var t=document.querySelector("h1");t&&(t.textContent=e)})}})();